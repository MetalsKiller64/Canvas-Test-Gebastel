<html>
	<head>
	 <script>
			var background_tiles = {};
			var max_background_x = 0;
			var max_background_y = 0;
			
			function store_background_tile(x_id, y_id, posx, posy, is_solid, img)
			{
				//Die Tiles werden in einem globalen Dictionary gespeichert, sodass f체r jedes Tile Koordinaten und andere Eigenschaften zug채nglich sind
				if ( background_tiles[x_id] == undefined ) 
				{
					//console.log("debug: store_background_tile: "+x_id+" undefined")
					background_tiles[x_id] = {};
				}
				if ( background_tiles[x_id][y_id] == undefined )
				{
					//console.log("debug: store_background_tile: "+x_id+"|"+y_id+" undefined")
					background_tiles[x_id][y_id] = [posx, posy, is_solid, img];
				}
				else
				{
					console.log("das tile mit der x_id \""+x_id+"\" und der y_id \""+y_id+"\" existiert bereits!");
				}
			}
			
			function get_background_tile(number)
			{
				var img_obj = new Image();
				img_obj.src = "images/grass_tile"+number+".png";
				return img_obj;
			}
			
			function generate_random_background()
			{	
				var start_x = 0;
				var start_y = 0;
				var final_x = 480;
				var final_y = 400;
				var stepped_x = start_x;
				var stepped_y = start_y;
				var step = 40;
				var x = 0;
				var y = 0;
				for ( x = 0; x < 20; x++ )
				{
					if ( stepped_x > final_x )
					{
						max_background_x = x;
						break;
					}
					var random_x = Math.floor((Math.random() * 4) + 1);
					var random_tile_x = get_background_tile(random_x);
					store_background_tile(x, y, stepped_x, stepped_y, false, random_tile_x);
					console.log("++++++++++++x: "+x+", "+y+", "+stepped_x+", "+stepped_y+"  ++++++++++++");
					for ( y = 0; y < 20; y++ )
					{
						if ( stepped_y > final_y )
						{
							max_background_y = y;
							break;
						}
						var random_y = Math.floor((Math.random() * 4) + 1);
						var random_tile_y = get_background_tile(random_y)
						store_background_tile(x, y, stepped_x, stepped_y, false, random_tile_y);
						console.log("y: "+y);
						stepped_y = stepped_y + step;
					}
					y = 0;
					stepped_x = stepped_x + step;
					stepped_y = start_y;
				}
				/*for ( y = 0; y < 20; y++ )
					{
						var random_y = Math.floor((Math.random() * 4) + 1);
						var random_tile_y = get_background_tile(random_x)
						store_background_tile(0, y, start_x, stepped_y, false, random_tile_y);
						stepped_y = stepped_y + step;
				}*/
				draw_background();
			}
			
			function list_background_tiles()
			{
				var x = 0;
				var y = 0;
				for ( var x = 0; x < 20; x++ )
				{
					if ( x == max_background_x )
					{
						break;
					}
					tile = background_tiles[x][y];
					console.log(x+", "+y);
					tx = tile[0];
					ty = tile[1];
					img = tile[3];
					console.log("--x: ["+tx+","+ty+"]--");
					for ( y = 0; y < 20; y++ )
					{
						if ( y == max_background_y )
						{
							break;
						}
						console.log(x+", "+y);
						tile = background_tiles[x][y];
						tx = tile[0];
						ty = tile[1];
						img = tile[3];
						console.log("y: ["+tx+","+ty+"]");
					}
					y = 0;
				}
				
				
				/*for ( x = 0; x < Object.keys(background_tiles).length; x++ )
				{
					console.log(x+","+y+" "+background_tiles[x,y])
					for ( y = 1; y < Object.keys(background_tiles[x]).length; y++)
					{
						console.log(x+","+y+" "+background_tiles[x,y])
					}
				}*/
			}
			
			function draw_background()
			{
				//TODO: hier soll der Hintergrund mit den ausgew채hlten background_tiles gemalt werden, dazu muss allerdings das Ausw채hlen der tiles erstmal funzen!
				var bg_x = 10;
				var bg_y = 10;
				bg_canvas = document.getElementById("background_canvas");
				c = bg_canvas.getContext("2d");
				var y = 0;
				
				/*for ( var x = 0; x < 20; x++ )
				{
					tile = background_tiles[x][y];
					tx = tile[0];
					ty = tile[1];
					img = tile[3];
					c.drawImage(img, tx, ty, 40, 40);
					for ( y = 0; y < 20; y++ )
					{
						tile = background_tiles[x][y];
						tx = tile[0];
						ty = tile[1];
						img = tile[3];
						c.drawImage(img, tx, ty, 40, 40);
					}
				}*/

				for ( var x = 0; x < 20; x++ )
				{
					if ( x == max_background_x )
					{
						break;
					}
					tile = background_tiles[x][y];
					//console.log(x+", "+y);
					tx = tile[0];
					ty = tile[1];
					img = tile[3];
					//console.log("--x: ["+tx+","+ty+"]--");
					c.drawImage(img, tx, ty, 40, 40);
					for ( y = 0; y < 20; y++ )
					{
						if ( y == max_background_y )
						{
							break;
						}
						//console.log(x+", "+y);
						tile = background_tiles[x][y];
						tx = tile[0];
						ty = tile[1];
						img = tile[3];
						//console.log("y: ["+tx+","+ty+"]");
						c.drawImage(img, tx, ty, 40, 40);
					}
					y = 0;
				}
				
				
				background_tiles = {};
				/*for ( var count = 0; count < 10; count++ )
				{
					if ( count != 0 )
					{
						bg_x = bg_x + 40;
					}
					var img = load_background_image()
					
					c.drawImage(img, bg_x, bg_y, 40, 40);
				}*/
				//bg_image = new Image();
				//bg_image.src = background1;
				//c.drawImage(bg_image, 10, 10, (6*80), (5*80))
			}
			
	 </script>
	</head>
	<body>
		<div style="position: relative;">
			<canvas id="background_canvas" width="480" height="400" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
			<canvas id="canvas" width="480" height="400" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
		</div>
		<button onclick="javascript:generate_random_background()" style="position: absolute; left: 0; top: 500;">generate_random_bg</button>
		<button onclick="javascript:list_background_tiles()" style="position: absolute; left: 150; top: 500;">list tiles</button>
	</body>
</html>